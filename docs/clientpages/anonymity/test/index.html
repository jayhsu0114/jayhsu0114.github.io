<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中山匿名網頁</title>
    <link rel="stylesheet" href="style.css"> <!-- 引入外部的 CSS 文件路径 -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2383721687553257" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <h1>中山匿名網頁</h1>
        <form id="zsjhForm">
            <label for="anonymousContent">匿名內容</label>
            <textarea id="anonymousContent" name="anonymousContent" required></textarea>
            <p>提交表示您同意<a href="/clientpages/regulations">使用協議</a></p>
            <input type="hidden" id="userId" name="userId">
            <input type="hidden" id="formId" name="formId" value="zsjh">
            <button type="button" id="submitButton">提交</button>
            <canvas id="contentCanvas" style="display: none; position: absolute;"></canvas>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3.3.1/dist/fp.min.js"></script>
    <script src="./js/Angelia.js"></script>
    <script src="./js/bubble.js"></script>
    <!--<script src="./js/post.js"></script>-->
    <script>
        document.getElementById('submitButton').addEventListener('click', function() {
            var textarea = document.getElementById('anonymousContent');
            var canvas = document.getElementById('contentCanvas');
            var text = textarea.value;

            // 獲取textarea的寬高和位置
            var width = textarea.offsetWidth;
            var height = textarea.offsetHeight;
            var rect = textarea.getBoundingClientRect();

            // 設置canvas的寬高與textarea一致
            canvas.width = width;
            canvas.height = height;

            // 設置canvas的位置
            canvas.style.left = rect.left + 'px';
            canvas.style.top = rect.top + 'px';

            // 顯示canvas，隱藏textarea
            canvas.style.display = 'block';
            textarea.style.display = 'none';

            var context = canvas.getContext('2d');
            context.font = '16px Arial'; // 設置字體
            context.textBaseline = 'top'; // 設置文本基線為頂部對齊
            context.fillStyle = '#000'; // 設置文本顏色

            // 將文本按行拆分並逐行顯示在canvas上
            var lineHeight = 20; // 設置行高
            var lines = text.split('\n');
            var x = 10;
            var y = 0;
            var maxWidth = width - 20;

            lines.forEach(function(line) {
                var words = line.split(' ');
                var currentLine = '';

                words.forEach(function(word) {
                    var testLine = currentLine + word + ' ';
                    var metrics = context.measureText(testLine);
                    var testWidth = metrics.width;

                    if (testWidth > maxWidth && currentLine.length > 0) {
                        context.fillText(currentLine, x, y);
                        currentLine = word + ' ';
                        y += lineHeight;
                    } else {
                        currentLine = testLine;
                    }
                });

                context.fillText(currentLine, x, y);
                y += lineHeight;
            });
        });
    </script>
</body>
</html>
