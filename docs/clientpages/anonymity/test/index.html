<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中山匿名網頁</title>
    <link rel="stylesheet" href="style.css"> <!-- 引入外部的 CSS 文件路径 -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2383721687553257" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <h1>中山匿名網頁</h1>
        <form id="zsjhForm">
            <label for="anonymousContent">匿名內容</label>
            <textarea id="anonymousContent" name="anonymousContent" required></textarea>
            
            <!-- Canvas 生成在這里 -->
             <center>
            <canvas id="contentCanvas" style="display: none;"></canvas>
            </center>
            
            <p>提交表示您同意<a href="/clientpages/regulations">使用協議</a></p>
            <input type="hidden" id="userId" name="userId">
            <input type="hidden" id="formId" name="formId" value="zsjh">
            <button type="button" id="submitButton">提交</button>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3.3.1/dist/fp.min.js"></script>
    <script src="./js/Angelia.js"></script>
    <script src="./js/bubble.js"></script>
    <!--<script src="./js/post.js"></script>-->
    <script>
        document.getElementById('submitButton').addEventListener('click', function() {
            var textarea = document.getElementById('anonymousContent');
            var canvas = document.getElementById('contentCanvas');
            var text = textarea.value;

            // 每15個字符插入一個換行符
            text = text.replace(/(.{15})/g, '$1\n');

            // 獲取textarea的寬高
            var width = textarea.offsetWidth;
            var height = textarea.offsetHeight;

            // 設置canvas的寬高與textarea一致
            canvas.width = width;
            canvas.height = height;

            // 顯示canvas，隱藏textarea
            canvas.style.display = 'block';
            textarea.style.display = 'none';

            var context = canvas.getContext('2d');

            // 设置canvas背景色为白色
            context.fillStyle = '#FFFFFF'; // 背景色白色
            context.fillRect(0, 0, canvas.width, canvas.height);

            context.font = '16px Arial'; // 設置字體
            context.textBaseline = 'top'; // 設置文本基線為頂部對齊
            context.fillStyle = '#70a7dd'; // 設置文本顏色

            // 將文本按行拆分並逐行顯示在canvas上
            var lines = text.split('\n');
            for (var i = 0; i < lines.length; i++) {
                context.fillText(lines[i], 10, i * 20);
            }

            // 開始動畫
            startAnimation(canvas, textarea);
        });

        function startAnimation(canvas, textarea) {
            var context = canvas.getContext('2d');
            var startTime;
            var duration = 2000; // 設置每個階段的動畫持續時間

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                var elapsed = timestamp - startTime;

                // 計算進度（0 到 1）
                var progress = Math.min(elapsed / duration, 1);

                // 漸變顏色
                var gradient = context.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#FFFFFF');
                gradient.addColorStop(progress, '#70a7dd');
                context.fillStyle = gradient;
                context.fillRect(0, 0, canvas.width, canvas.height);

                // 漸變形狀
                var radius = (canvas.height / 2) * progress;
                context.clearRect(0, 0, canvas.width, canvas.height);
                context.beginPath();
                context.arc(canvas.width / 2, canvas.height / 2, radius, 0, Math.PI * 2);
                context.closePath();
                context.fill();

                // 向上移動和縮小
                canvas.style.transform = `translateY(${-100 * progress}px) scale(${1 - 0.65 * progress})`;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // 繼續向上移動直到完全超出螢幕邊界
                    finishAnimation(canvas, textarea);
                }
            }

            requestAnimationFrame(animate);
        }

        function finishAnimation(canvas, textarea) {
            var startTime;
            var duration = 1000; // 設置最後階段的動畫持續時間

            function animate(timestamp) {
                if (!startTime) startTime = timestamp;
                var elapsed = timestamp - startTime;

                // 計算進度（0 到 1）
                var progress = Math.min(elapsed / duration, 1);

                // 繼續向上移動直到完全超出螢幕邊界
                canvas.style.transform = `translateY(${-100 - 200 * progress}px) scale(${0.35 - 0.35 * progress})`;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // 隱藏canvas，顯示textarea
                    canvas.style.display = 'none';
                    textarea.style.display = 'block';
                }
            }

            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>
