<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TEST審核頁面</title>
  <link rel="stylesheet" href="style.css">
  <script>
    sessionStorage.clear();

    let data = []; // Array to store fetched data
    let currentIndex = 0; // Index to track current data set

    // Function to fetch data and populate the fields
    async function fetchData() {
      try {
        const response = await fetch('https://google-sheets-proxy-mk66ircp2a-uc.a.run.app/test-sheet-data');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        data = await response.json();
        console.log(data);

        if (data.length > 0) {
          populateFields(currentIndex); // Populate fields with the first set of data
        } else {
          console.error('No data available.');
        }
      } catch (error) {
        console.error('There was a problem with the fetch operation:', error);
      }
    }

    function populateFields(index) {
      if (index >= 0 && index < data.length) {
        const dataSet = data[index];
        if (dataSet.length >= 4) {
          document.getElementById('timestamp').value = dataSet[0];
          document.querySelector('textarea').value = dataSet[1];
          document.getElementById('userid').value = dataSet[2];
          document.getElementById('status').value = dataSet[3];
        } else {
          console.error('Insufficient data in the current set.');
        }
      } else {
        console.error('Index out of bounds.');
      }
    }

    function handleButtonClick(status) {
      document.getElementById('manager-status').value = status;
      currentIndex++;
      if (currentIndex < data.length) {
        populateFields(currentIndex);
      } else {
        console.error('No more data available.');
        document.querySelector('#edit-end button').classList.add('completed'); // Add the class to change button style
      }
    }

    window.onload = function() {
      fetchData();

      // Add event listeners to the buttons
      document.getElementById('pass').addEventListener('click', function() {
        handleButtonClick('通過');
      });

      document.getElementById('fail').addEventListener('click', function() {
        handleButtonClick('不通過');
      });
    };
  </script>
</head>
<body>
  <div id="container">
    <form>
      <div id="anonymity-data">
        <input type="text" id="timestamp" name="timestamp">
        <br><br>
        <textarea></textarea>
        <br><br>
        <input type="text" id="userid" name="userid" READONLY>
        <br><br>
        <input type="text" id="status" name="status" readonly>
      </div>

      <div id="data-status">
        <button type="button" id="pass">通過</button>
        <button type="button" id="fail">不通過</button>
      </div>
      <div id="manager">
        <input type="text" id="manager-status" readonly>
        <input type="text" id="managerid" value="ZSJH000" readonly>
      </div>
    </form>
  </div>

  <div id="edit-options">
    <button type="button" id="prev" value="prev">上一則</button>
    <button type="button" id="next" value="next">下一則</button>
  </div>
  
  <div id="edit-end">
    <button type="button">完成審核</button>
  </div>

  <div id="management-buttons">
    <a href="https://anoncoultd.com/managementpages/actions/databaseview/test"><button type="button">回資料庫</button></a>
    <a href="https://anoncoultd.com/managementpages/actions/anonymitypost/test"><button type="button">發布頁面</button></a>
  </div>
</body>
</html>
