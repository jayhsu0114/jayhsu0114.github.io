// anonymity-post/zsjh/postmaker.js

const { createCanvas, loadImage } = require('canvas');
const path = require('path');
const fs = require('fs');

async function createImageWithText(inputText, inputFlow, inputId, inputTimestamp) {
  const templatePath = path.join(__dirname, 'template.png');
  const outputPath = path.join(__dirname, 'result.png');

  // 加載模板圖片
  const template = await loadImage(templatePath);

  // 創建一個 canvas 對象
  const canvas = createCanvas(template.width, template.height);
  const ctx = canvas.getContext('2d');

  // 在 canvas 上繪製模板圖片
  ctx.drawImage(template, 0, 0, template.width, template.height);

  // 設定字體和顏色
  ctx.font = '36px Arial';
  ctx.fillStyle = '#000'; // 黑色字體
  ctx.textAlign = 'center';

  // 設定文字位置和內容
  const centerX = template.width / 2;
  ctx.fillText(inputText, centerX, 200); // 內容位置

  ctx.fillStyle = '#E76F51'; // 流量顏色
  ctx.fillText(inputFlow, centerX, 400); // 流量位置

  ctx.fillStyle = '#F4A261'; // 編號顏色
  ctx.fillText(inputId, centerX, 450); // 編號位置

  ctx.fillStyle = '#2A9D8F'; // 投稿標記顏色
  ctx.fillText(inputTimestamp, centerX, 500); // 時間標記位置

  // 將生成的圖片保存為文件
  const buffer = canvas.toBuffer('image/png');
  fs.writeFileSync(outputPath, buffer);

  return outputPath;
}

module.exports = {
  createImageWithText,
};
